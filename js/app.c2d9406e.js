(function(e){function t(t){for(var n,r,c=t[0],l=t[1],o=t[2],f=0,d=[];f<c.length;f++)r=c[f],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&d.push(a[r][0]),a[r]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);u&&u(t);while(d.length)d.shift()();return i.push.apply(i,o||[]),s()}function s(){for(var e,t=0;t<i.length;t++){for(var s=i[t],n=!0,c=1;c<s.length;c++){var l=s[c];0!==a[l]&&(n=!1)}n&&(i.splice(t--,1),e=r(r.s=s[0]))}return e}var n={},a={app:0},i=[];function r(t){if(n[t])return n[t].exports;var s=n[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=n,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],l=c.push.bind(c);c.push=t,c=c.slice();for(var o=0;o<c.length;o++)t(c[o]);var u=l;i.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"56d7":function(e,t,s){"use strict";s.r(t);s("e260"),s("e6cf"),s("cca6"),s("a79d"),s("f5df1");var n=s("2b0e"),a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("FilmsList",{attrs:{films:e.getFilms()},on:{SelectFilm:function(t){return e.selectFilm(t)}}}),null!==e.selectedFilmId?s("SessionsList",{attrs:{sessions:e.getSessions()},on:{Bought:e.onBought}}):e._e()],1)},i=[],r=(s("d81d"),s("96cf"),s("1da1")),c=(s("4160"),s("159b"),s("d4ec")),l=s("bee2"),o=s("bc3a"),u=s.n(o),f="9c7b675f9aa1962d9049582aa1d2321c",d="https://image.tmdb.org/t/p/w500",h="https://api.themoviedb.org/3/movie/popular?api_key=".concat(f),m=function(){function e(){Object(c["a"])(this,e)}return Object(l["a"])(e,[{key:"get",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.a.get(h);case 3:return t=e.sent,e.abrupt("return",t.data);case 7:return e.prev=7,e.t0=e["catch"](0),e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()}]),e}(),p=(s("fb6a"),function(){function e(t,s){return Object(c["a"])(this,e),this.data=[],this.datesCreate(),this.seansesCreate(t,s),this.data}return Object(l["a"])(e,[{key:"datesCreate",value:function(){var e=new Date;e.setDate(e.getDate()-11);for(var t=0;t<=14;t+=1)e.setDate(e.getDate()+1),this.data.push({date:e.toISOString().slice(0,10)})}},{key:"seansesCreate",value:function(e,t){this.data.forEach((function(e){e.seanses=[];for(var t=10;t<=20;t+=2)e.seanses.push({time:"".concat(t,".00")})})),this.seatsCreate(e,t)}},{key:"seatsCreate",value:function(e,t){this.data.forEach((function(s){s.seanses.forEach((function(s){s.rows=[];for(var n=0;n<e;n+=1){for(var a=[],i=0;i<t;i+=1)a.push({s:Math.random()<.5?"f":"r"});s.rows.push(a)}}))}))}}]),e}()),b=function(){function e(){Object(c["a"])(this,e),this.timetable=[]}return Object(l["a"])(e,[{key:"get",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.check();case 2:return e.abrupt("return",this.timetable);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"check",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(localStorage.getItem("timetable")&&!(Date.now()-JSON.parse(localStorage.getItem("timetable")).timestamp>864e5)){e.next=5;break}return e.next=3,this.create();case 3:e.next=6;break;case 5:this.timetable=JSON.parse(localStorage.getItem("timetable")).data;case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"create",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(new m).get();case 2:t=e.sent,t.results.forEach((function(e){s.timetable.push({title:e.title,backdrop:d+e.backdrop_path})})),this.timetable.forEach((function(e){e.sessions=new p(16,12)})),localStorage.setItem("timetable",JSON.stringify({timestamp:Date.now(),data:this.timetable}));case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),e}(),v=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"films"},[s("el-carousel",{staticClass:"films__carousel",attrs:{autoplay:!1,type:e.carouselType,arrow:e.carouselArrow,"indicator-position":"outside",trigger:"click",height:e.carouselHeight}},e._l(e.films,(function(t,n){return s("el-carousel-item",{key:n,staticClass:"films__item film",nativeOn:{click:function(t){return e.selectFilm(n)}}},[s("div",{ref:"slideWrapper",refInFor:!0,staticClass:"film__wrapper"},[s("el-image",{staticClass:"film__backdrop",attrs:{src:t.backdrop,alt:t.title},on:{load:e.calculateHeight}}),s("h2",{staticClass:"film__title"},[e._v(e._s(t.title))])],1)])})),1)],1)},g=[],w={name:"FilmsList",props:{films:Array},mounted:function(){this.setType(),window.addEventListener("resize",this.setType),window.addEventListener("resize",this.calculateHeight)},destroyed:function(){window.removeEventListener("resize",this.setType),window.removeEventListener("resize",this.calculateHeight)},data:function(){return{carouselType:"card",carouselArrow:"hover",carouselHeight:"200px"}},methods:{calculateHeight:function(){var e=this;this.$refs.slideWrapper?this.$refs.slideWrapper.forEach((function(t){t.closest(".is-active")&&(e.carouselHeight="".concat(t.clientHeight,"px"))})):this.carouselHeight="400px"},setType:function(){this.carouselType=document.documentElement.clientWidth>=768?"card":""},selectFilm:function(e){this.$emit("SelectFilm",e)}},watch:{carouselType:function(e){this.carouselArrow="card"===e?"hover":"always"}}},_=w,S=(s("9ee6"),s("2877")),y=Object(S["a"])(_,v,g,!1,null,"116ce600",null),k=y.exports,T=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"sessions"},[e.sessions.length?[s("div",{staticClass:"sessions__aside",class:e.AsideClasses()},[s("date-picker",{class:e.AsideClasses(),attrs:{dates:e.getDates(),clear:e.clear},on:{DateSelect:function(t){return e.onSelectDate(t)}}}),e.selectedDate?s("time-picker",{class:e.AsideClasses(),attrs:{times:e.getTimes(e.selectedDate),selectedTime:e.selectedTime},on:{TimeSelect:function(t){return e.onSelectTime(t)}}}):e._e(),e.selectedTime?s("basket",{attrs:{selectedSeats:e.selectedSeats},on:{SeatsBought:e.onBought}}):e._e()],1),s("transition",{attrs:{name:"showing"}},[e.selectedTime?s("seat-picker",{attrs:{rows:e.getRows(e.selectedDate,e.selectedTime),selectedSeats:e.selectedSeats},on:{SeatSelect:function(t){return e.addToSelected(t)}}}):e._e()],1)]:e._e()],2)},C=[],D=(s("c740"),s("a434"),s("ac1f"),s("466d"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"date-picker"},[s("elDatePicker",{attrs:{type:"date",placeholder:"Pick a day","picker-options":e.pickerOptions},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}})],1)}),O=[],x=(s("45fc"),{name:"DatePicker",props:{dates:{type:Array,default:function(){return[]}},clear:Boolean},data:function(){var e=this;return{date:"",pickerOptions:{disabledDate:function(t){return!e.dates.some((function(e){return t.setHours(0)===e.setHours(0)}))}}}},methods:{},watch:{clear:function(e){e&&(this.date="")},date:function(e){e&&this.$emit("DateSelect",e)}}}),j=x,E=(s("dd62"),Object(S["a"])(j,D,O,!1,null,"14ba9f4e",null)),$=E.exports,F=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"times"},[s("ul",{staticClass:"times__list"},e._l(e.times,(function(t,n){return s("li",{key:n,staticClass:"times__item",class:e.getClasses(t.time),on:{click:function(s){return e.selectTime(t)}}},[e._v(" "+e._s(t.time)+" "),t.available?e._e():s("span",{staticClass:"times__item-info"},[e._v("архив")])])})),0)])},A=[],I={name:"TimePicker",props:{times:{type:Array,default:function(){return[]}},selectedTime:String},methods:{getClasses:function(e){return{selected:this.selectedTime===e}},selectTime:function(e){this.$emit("TimeSelect",e)}}},P=I,B=(s("b7df"),Object(S["a"])(P,F,A,!1,null,"96a40cdc",null)),H=B.exports,L=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"show",rawName:"v-show",value:e.rows.length,expression:"rows.length"}],staticClass:"hall"},[s("p",{staticClass:"hall__display"},[e._v("Экран")]),s("ol",{staticClass:"hall__rows-list"},e._l(e.rows,(function(t,n){return s("li",{key:n,staticClass:"hall__rows-item row"},[s("p",{staticClass:"row__num"},[e._v("Ряд "+e._s(n+1))]),s("ul",{staticClass:"row__seats-list"},e._l(t,(function(t,a){return s("li",{key:a,ref:"seat",refInFor:!0,staticClass:"row__seats-item",class:e.getStatus(t),attrs:{"data-row":n,"data-seat":a},on:{click:function(t){return e.selectSeat(n,a)}}})})),0),s("p",{staticClass:"row__num"},[e._v(e._s(n+1)+" Ряд")])])})),0)])},R=[],M={name:"SeatPicker",props:{rows:Array,selectedSeats:Array},methods:{getStatus:function(e){return"r"===e.s?"reserved":"free"},selectSeat:function(e,t){"r"!==this.rows[e][t].s&&this.$emit("SeatSelect",{info:this.rows[e][t],row:e,seat:t})}},watch:{selectedSeats:function(){var e=this;this.$refs.seat&&this.$refs.seat.forEach((function(t){t.classList.remove("select"),e.selectedSeats.some((function(e){return e.row===+t.getAttribute("data-row")&&e.seat===+t.getAttribute("data-seat")}))&&t.classList.add("select")}))}}},J=M,N=(s("59fb"),Object(S["a"])(J,L,R,!1,null,null,null)),z=N.exports,W=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"basket"},[s("el-button",{staticClass:"basket__btn",attrs:{disabled:!e.selectedSeats.length,type:"success"},on:{click:e.onBuyClick}},[e._v("Забронировать "+e._s(e.selectedSeats.length)+" билет"+e._s(e.getEndings))])],1)},q=[],G={name:"Basket",props:{selectedSeats:Array},methods:{onBuyClick:function(){this.$emit("SeatsBought")}},computed:{getEndings:function(){var e="",t=Math.floor(this.selectedSeats.length/10)%10,s=this.selectedSeats.length%10;return 1!==t?s>1&&s<5?e="а":1!==s&&(e="ов"):e="ов",e}}},K=G,Q=(s("d50d"),Object(S["a"])(K,W,q,!1,null,"452f16c9",null)),U=Q.exports,V={name:"SessionsList",components:{DatePicker:$,TimePicker:H,SeatPicker:z,Basket:U},props:{sessions:{type:Array,default:function(){return[]}}},data:function(){return{selectedDate:null,selectedTime:null,selectedSeat:null,selectedSeats:[],allowSelect:!1,clear:!1}},methods:{AsideClasses:function(){return{moved:this.selectedTime}},onSelectDate:function(e){this.selectedDate=e},onSelectTime:function(e){this.selectedTime=e.time,this.allowSelect=e.available},onBought:function(){this.selectedSeats.forEach((function(e){e.info.s="r"})),this.selectedSeats=[],this.$emit("Bought")},addToSelected:function(e){if(this.allowSelect){var t=this.selectedSeats.findIndex((function(t){return t.row===e.row&&t.seat===e.seat}));-1!==t?this.selectedSeats.splice(t,1):this.selectedSeats.push(e)}else this.selectedSeats=[]},getDates:function(){return this.sessions.map((function(e){return new Date(e.date)}))},getTimes:function(e){var t=this,s=[];return this.sessions.forEach((function(n){new Date(n.date).toDateString()===new Date(e).toDateString()&&(s=n.seanses.map((function(e){var s={time:e.time},n=null;if(e.time&&(n=e.time.match(/(\d{1,2})\.(\d{1,2})/)),n){var a=new Date(t.selectedDate);a.setHours(n[1]),a.setMinutes(n[2]),s.available=a>Date.now()}else s.available=!1;return s})))})),s},getRows:function(e,t){var s=[];return this.sessions.forEach((function(n){new Date(n.date).toDateString()===new Date(e).toDateString()&&n.seanses.forEach((function(e){e.time===t&&(s=e.rows)}))})),s}},watch:{selectedDate:function(){this.selectedSeats=[],this.selectedTime=null},selectedTime:function(){this.selectedSeats=[]},sessions:function(){var e=this;this.clear=!0,this.selectedDate=null,this.selectedTime=null,this.selectedSeat=null,this.selectedSeats=[],this.$nextTick((function(){e.clear=!1}))}}},X=V,Y=(s("bc6f"),Object(S["a"])(X,T,C,!1,null,"747b6cb2",null)),Z=Y.exports,ee={name:"App",components:{FilmsList:k,SessionsList:Z},mounted:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(new b).get();case 2:e.timeTable=t.sent;case 3:case"end":return t.stop()}}),t)})))()},data:function(){return{selectedFilmId:null,timeTable:[]}},methods:{onBought:function(){localStorage.setItem("timetable",JSON.stringify({timestamp:Date.now(),data:this.timeTable}))},selectFilm:function(e){this.selectedFilmId=e},getFilms:function(){return this.timeTable.map((function(e){return{title:e.title,backdrop:e.backdrop}}))},getSessions:function(){return null===this.selectedFilmId?[]:this.timeTable[this.selectedFilmId].sessions}}},te=ee,se=(s("5c0b"),Object(S["a"])(te,a,i,!1,null,null,null)),ne=se.exports,ae=s("b2d6"),ie=s.n(ae),re=s("4897"),ce=s.n(re),le=(s("377f"),s("5c96")),oe=[le["Button"],le["DatePicker"],le["Carousel"],le["CarouselItem"],le["Image"]];ce.a.use(ie.a),oe.forEach((function(e){return n["default"].use(e,{locale:ce.a})})),n["default"].config.productionTip=!1,new n["default"]({render:function(e){return e(ne)}}).$mount("#app")},"59fb":function(e,t,s){"use strict";s("b541")},"5c0b":function(e,t,s){"use strict";s("9c0c")},6824:function(e,t,s){},"7d8f":function(e,t,s){},"9c0c":function(e,t,s){},"9ee6":function(e,t,s){"use strict";s("eb37")},b541:function(e,t,s){},b7df:function(e,t,s){"use strict";s("6824")},b9d3:function(e,t,s){},bc6f:function(e,t,s){"use strict";s("bc82")},bc82:function(e,t,s){},d50d:function(e,t,s){"use strict";s("b9d3")},dd62:function(e,t,s){"use strict";s("7d8f")},eb37:function(e,t,s){}});
//# sourceMappingURL=app.c2d9406e.js.map